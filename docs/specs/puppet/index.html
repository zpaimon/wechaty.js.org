<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Wechaty Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Wechaty Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-88739146-3","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Wechaty" href="/opensearch.xml">
<link rel="stylesheet" href="/css/gitter-sidecar.css">
<script src="/js/gitter-sidecar.js"></script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async></script><title data-react-helmet="true">Wechaty Puppet | Wechaty</title><meta data-react-helmet="true" property="og:image" content="https://wechaty.js.org/img/wechaty-icon.png"><meta data-react-helmet="true" name="twitter:image" content="https://wechaty.js.org/img/wechaty-icon.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wechaty.js.org/docs/specs/puppet"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Wechaty Puppet | Wechaty"><meta data-react-helmet="true" name="description" content="The term Puppet in Wechaty is an Abstract Class for implementing protocol plugins. The plugins are the component that helps Wechaty to control the IMs like WeChat(that&#x27;s the reason we call it puppet!)."><meta data-react-helmet="true" property="og:description" content="The term Puppet in Wechaty is an Abstract Class for implementing protocol plugins. The plugins are the component that helps Wechaty to control the IMs like WeChat(that&#x27;s the reason we call it puppet!)."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wechaty.js.org/docs/specs/puppet"><link data-react-helmet="true" rel="alternate" href="https://wechaty.js.org/docs/specs/puppet" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wechaty.js.org/docs/specs/puppet" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.c61e225c.css">
<link rel="preload" href="/assets/js/styles.c2065dab.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.fe416c82.js" as="script">
<link rel="preload" href="/assets/js/main.ed8f1f7a.js" as="script">
<link rel="preload" href="/assets/js/1.b730686f.js" as="script">
<link rel="preload" href="/assets/js/2.474dd42e.js" as="script">
<link rel="preload" href="/assets/js/3.0266c80a.js" as="script">
<link rel="preload" href="/assets/js/1be78505.200364f1.js" as="script">
<link rel="preload" href="/assets/js/167.6b2947d8.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.df2000e1.js" as="script">
<link rel="preload" href="/assets/js/17896441.44b72e1f.js" as="script">
<link rel="preload" href="/assets/js/8153f4e2.2716646b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_3wvD">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_z9Sw"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--light_2_E0 navbar__logo"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--dark_2JiM navbar__logo"><strong class="navbar__title"></strong></a></div><div class="navbar__items navbar__items--right"><a href="https://wechaty.js.org/news/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">News</a><a href="https://wechaty.js.org/blog/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://wechaty.js.org/contributors/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contributors</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/wechaty">Introduction</a></li><li><a class="dropdown__link" href="/docs/tutorials/">Tutorials</a></li><li><a class="dropdown__link" href="/docs/explainations/">Explainations</a></li><li><a class="dropdown__link" href="/docs/references/">References</a></li><li><a class="dropdown__link" href="/docs/howto/">How-to Guides</a></li></ul></div><a href="https://github.com/wechaty/wechaty#readme" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2XYw"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_2wFP">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_2wFP">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--light_2_E0 navbar__logo"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--dark_2JiM navbar__logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://wechaty.js.org/news/" target="_self" rel="noopener noreferrer" class="menu__link">News</a></li><li class="menu__list-item"><a href="https://wechaty.js.org/blog/" target="_self" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://wechaty.js.org/contributors/" target="_blank" rel="noopener noreferrer" class="menu__link">Contributors</a></li><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/docs/">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/wechaty">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/">Tutorials</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/explainations/">Explainations</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/references/">References</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/howto/">How-to Guides</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/wechaty/wechaty#readme" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_3jyA"><div class="docSidebarContainer_3jRz" role="complementary"><div class="sidebar_2j-V sidebarWithHideableNavbar_2fMR"><a tabindex="-1" class="sidebarLogo_1OGv" href="/"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--light_2_E0"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--dark_2JiM"><strong></strong></a><div class="menu menu--responsive thin-scrollbar menu_1Xkn"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Vtis" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/wechaty">What is Wechaty</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Showcases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/showcases/">Showcases: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/showcases/osschat-bot">OSS.Chat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/showcases/rui-bot">Rui.BOT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/showcases/friday-bot">Friday BOT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/showcases/awesome-wechaty">Awesome projects&#x27;</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/community/">Community overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">开源软件供应链点亮计划</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ospp/">开源软件供应链点亮计划: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ospp/2021">暑期 2021</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ospp/2020">暑期 2020</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Google Season of Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gsod/">GSoD: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gsod/ideas">Ideas list</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gsod/2021">Google Season of Docs 2021 proposal</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bot5/">BOT Friday Club</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Google Summer of Code</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gsoc/">GSoC: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gsoc/ideas">Ideas list</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gsoc/2021">GSoC 2021</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/">Contributing to Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/new-contributors">Advice for new contributors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/documentation">Write documentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributor-program/">Contributor program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/devops">DevOps with CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/pulls">Create pull requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/blog">Publish blog</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/coding">Write code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/git">Working with git</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/issues">File issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing/testing">Testing</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/changelog">Changelog</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/">Tutorials: Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/quick-start">Quick start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/hard-way">The hard way</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Case Study</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/case-study/">Case study: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/case-study/money-bot">Money BOT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/case-study/assistant-bot">Assistant BOT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/case-study/coaxer-bot">Coaxer BOT</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/video-tutorial">Video tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/docker">Usage with Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/usage-with-heroku">Usage with Heroku</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/using-plugin-with-wechaty">Using Plugin with Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/using-vorpal-with-wechaty">Using Vorpal with Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/using-redux-with-wechaty">Using Redux with Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/cheatsheet">Cheat sheet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Explainations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/">Explainations: Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/conversational">Conversational</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/rpa">RPA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/motivations">Motivation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/concepts">Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/lifecycle">Life Cycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/alternatives">Alternatives</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/glossary">Glossary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/explainations/troubleshooting">Troubleshooting</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Docusaurus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docusaurus/doc1">Style Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docusaurus/mdx">Powered by MDX</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">References</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/references/">References: Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/">API: Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/wechaty">Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/message">Message</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/contact">Contact</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/room">Room</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/room-invitation">RoomInvitation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/friendship">Friendship</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Polyglot</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/">Polyglot: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/openapi/">OpenAPI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/typescript/">TypeScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/python/">Python</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/go/">Go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/java/">Java</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/scala/">Scala</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/php/">PHP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/dotnet/">.NET</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/rust/">Rust</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/polyglot/diy/">Polyglot: DIY</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Puppet Providers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/">Puppet Providers: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/wechat">WeChat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/whatsapp">Whatsapp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/official-account">Official Account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/gitter">Gitter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/lark">Lark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/padlocal">PadLocal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/wechat4u">WeChat4U</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/service">Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/mock">Mock</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-providers/diy">Puppet Provider: DIY</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Puppet Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/">Puppet Services: Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/wxwork">WXWork</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/padlocal">PadLocal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/paimon">Paimon</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/donut">Donut</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/compatibility">Puppet Service: Compatibility</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puppet-services/diy">Puppet Service: DIY</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Specifications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/specs/">Specs: Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/specs/wechaty">Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/specs/plugin">Plugin</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/specs/puppet">Puppet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/specs/service">Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/specs/token">Token</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/references/deprecations">Deprecation timeline</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How-to Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/">How-to Guides: Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/install">Install Wechaty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/wechaty">Create a bot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/event">Listening events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/message">Dealing with message</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/contact">Managing contacts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/room">Managing rooms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/friendship">Making friends</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/file-box">Processing files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto/testing">Writing tests</a></li></ul></li></ul></div></div></div><main class="docMainContainer_28SP"><div class="container padding-vert--lg docItemWrapper_3ZSj"><div class="row"><div class="col docItemCol_1o9i"><div class="docItemContainer_3nUq"><article><header><h1 class="docTitle_33JP">Wechaty Puppet</h1></header><div class="markdown"><p>The term <code>Puppet</code> in Wechaty is an Abstract Class for implementing protocol plugins. The plugins are the component that helps Wechaty to control the IMs like WeChat(that&#x27;s the reason we call it puppet!).</p><p>The plugins are named <code>PuppetXXX</code>, like <a href="https://github.com/wechaty/wechaty-puppet-puppeteer" target="_blank" rel="noopener noreferrer">PuppetPuppeteer</a> is using the <a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener noreferrer">google puppeteer</a> to control the <a href="https://wx.qq.com" target="_blank" rel="noopener noreferrer">WeChat Web API</a> via a chrome browser, <a href="https://github.com/padlocal/wechaty-puppet-padlocal" target="_blank" rel="noopener noreferrer">PuppetPadLocal</a> is using the Pad Protocol to connect with WeChat Server.</p><ul><li>Puppet Providers Directory: <a href="https://wechaty.js.org/docs/puppet-providers/" target="_blank" rel="noopener noreferrer">https://wechaty.js.org/docs/puppet-providers/</a></li><li>Puppet Compatibility Table: <a href="https://github.com/wechaty/wechaty-puppet/wiki/Compatibility" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/wiki/Compatibility</a></li><li>Puppet Development Guide: <a href="https://wechaty.js.org/docs/puppet-providers/diy" target="_blank" rel="noopener noreferrer">https://wechaty.js.org/docs/puppet-providers/diy</a></li><li>Puppet Related Links: <a href="https://github.com/wechaty/wechaty-puppet/wiki/Links" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/wiki/Links</a></li><li>Puppet Documentation: <a href="https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html" target="_blank" rel="noopener noreferrer">https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-wechaty-puppet"></a>What is Wechaty Puppet<a class="hash-link" href="#what-is-wechaty-puppet" title="Direct link to heading">#</a></h2><p>The term <code>Puppet</code> in Wechaty is a name that we had picked up to describe part of our system: Puppet is an Abstract Class for implementing plugins, the plugins are the component that helps Wechaty to control the Wechat, that&#x27;s the reason we call it <code>puppet</code>.</p><p>Plugins are named PuppetXXX, like PuppetPuppeteer is using the chrome puppeteer to control the WeChat Web API via a chrome browser, PuppetService is using the gRPC protocol to connect with a Protocol Server for controlling an iPad/Windows/whatever program.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="show-me-the-code"></a>Show me the code<a class="hash-link" href="#show-me-the-code" title="Direct link to heading">#</a></h2><p>For a deeper understanding of the Puppet in Wechaty, you can read its documentation from <a href="https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html" target="_blank" rel="noopener noreferrer">https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html</a> and source code if you like at <a href="https://github.com/wechaty/wechaty-puppet/blob/master/src/puppet.ts" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/blob/master/src/puppet.ts</a></p><p><img alt="abstract puppet" src="/assets/images/architecture-ef4e78c0bf9d9b359328f3de8751ebb1.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="important-puppets"></a>Important Puppets<a class="hash-link" href="#important-puppets" title="Direct link to heading">#</a></h3><ol><li><p>PuppetPuppeteer</p><p>A web solution to connect WeChat, Wechaty init implement is by web WeChat, which inject js code into chrome.</p></li><li><p>PuppetMock</p><p>A mock function to connect WeChat, not a real implement, for testing other connectors to connect with Wechaty, in other words: a mock solution to implement puppet. This is used for further to connect other solutions, such as iPad, Xposed, iOs, windows client...</p></li><li><p>PuppetPadLocal</p><p>An iPad solution to connect WeChat</p></li><li><p>PuppetService</p><p>See: &lt;/docs/puppet-services/&gt;</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="using-puppet-with-wechaty-examples"></a>Using Puppet with Wechaty Examples<a class="hash-link" href="#using-puppet-with-wechaty-examples" title="Direct link to heading">#</a></h2><ol><li><p>Using <a href="https://www.npmjs.com/package/wechaty-puppet-mock" target="_blank" rel="noopener noreferrer">wechaty-puppet-mock</a> to run <a href="https://github.com/wechaty/wechaty/blob/master/examples/ding-dong-bot.ts" target="_blank" rel="noopener noreferrer">ding-dong-bot</a></p><div class="codeBlockContainer_1ukp"><div class="codeBlockContent_3Y8q sh"><div tabindex="0" class="prism-code language-sh codeBlock_2Xgr thin-scrollbar"><div class="codeBlockLines_3Zfi" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">WECHATY_PUPPET=wechaty-puppet-mock npm start</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1mju">Copy</button></div></div></li><li><p>Using <a href="https://www.npmjs.com/package/wechaty-puppet-padpro" target="_blank" rel="noopener noreferrer">wechaty-puppet-padpro</a> to run <a href="https://github.com/wechaty/wechaty/blob/master/examples/ding-dong-bot.ts" target="_blank" rel="noopener noreferrer">ding-dong-bot</a></p><div class="codeBlockContainer_1ukp"><div class="codeBlockContent_3Y8q sh"><div tabindex="0" class="prism-code language-sh codeBlock_2Xgr thin-scrollbar"><div class="codeBlockLines_3Zfi" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">WECHATY_PUPPET=wechaty-puppet-padpro npm start</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1mju">Copy</button></div></div></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="basic-rules"></a>Basic Rules<a class="hash-link" href="#basic-rules" title="Direct link to heading">#</a></h2><p>Here are some rules that a Wechaty Puppet should follow:</p><ol class="contains-task-list"><li class="task-list-item"><input type="checkbox" disabled=""> <strong>Emit Self Messages</strong>: when the bot says anything, the bot should receive a message said by itself. (and the <code>message.self()</code> will return true for this message)</li><li class="task-list-item"><input type="checkbox" disabled=""> <strong>Perfect Logout</strong>: <code>logout</code> method should clean all the user session data from the puppet service, and the status of the App on the phone should display correctly (not log in on any devices).</li><li class="task-list-item"><input type="checkbox" disabled=""> <strong>State-less Session Management</strong> (with MemoryCard support): the puppet service should save the user session data to the memory card, and can be restored from the memory card. (See: #16)</li><li class="task-list-item"><input type="checkbox" disabled=""> <strong>MIME File Name Extension Convention</strong>: FileBoxChunk.name must be able to convert to a MIME type and versa visa. The puppet needs to set the name with the right extension (.jpg, .pdf, etc) to the name of the file box. See: <a href="https://github.com/wechaty/wechaty-puppet-hostie/discussions/115" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-hostie/discussions/115</a>,</li><li class="task-list-item"><input type="checkbox" disabled=""> To be added.</li></ol><p>See: <a href="https://github.com/wechaty/puppet-services/discussions/54" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/puppet-services/discussions/54</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="memorycard"></a>MemoryCard<a class="hash-link" href="#memorycard" title="Direct link to heading">#</a></h2><p>When a Wechaty bots logged in, it will have a authorized secret data to store their logged-in session, for example, the device information (62 data for pad protocol), the cookie (if you are using the web protocol), and the user session secrets, etc.</p><p>The <a href="https://github.com/huan/memory-card" target="_blank" rel="noopener noreferrer">memory card</a> is a module designed to store those data.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="wechaty-bot-login-with-memory-card-module"></a>Wechaty bot login with memory card module<a class="hash-link" href="#wechaty-bot-login-with-memory-card-module" title="Direct link to heading">#</a></h3><ol><li>wechaty start()</li><li>wechaty instanciates memory card (see <a href="https://github.com/wechaty/wechaty/blob/30c446b2b78c92166a1d613952e77d3e3fdbbe1f/src/wechaty.ts#L681" target="_blank" rel="noopener noreferrer">wechaty.ts:start()</a>)</li><li>wechaty set memory card to puppet (see <a href="https://github.com/wechaty/wechaty/blob/30c446b2b78c92166a1d613952e77d3e3fdbbe1f/src/wechaty.ts#L406" target="_blank" rel="noopener noreferrer">wechaty.ts:initPuppet()</a>)<ol><li>puppet start()</li><li>puppet load session from memory card</li><li>puppet logged in<ol><li>by loaded session, or</li><li>by scan qr code</li></ol></li><li>puppet save the session secret data to memory card</li></ol></li><li>memory card will be saved to file or network storage for future reuse</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h3><p>By saving the user login session secret data to memory card, the Wechaty system can save the state to local, so that it can make the puppet service provider service stateless.</p><p>Current neither of the Donut, WXWork, Rock, PadLocal have not support this stateless feature, nor the Wechaty system are ready for it.</p><p>To be implemented for our ecosystem.</p><p>See: <a href="https://github.com/wechaty/puppet-services/discussions/16" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/puppet-services/discussions/16</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="event-order"></a>Event Order<a class="hash-link" href="#event-order" title="Direct link to heading">#</a></h2><p>I think I can contribute some analytics to this problem:</p><ol><li>As the log &amp; puppet testing shows: the <code>ready</code> event is after the <code>login</code> event</li><li>However, the Wechaty system needs to load the contact payload of the <code>userSelf</code> before it emits the <code>login</code> event because the login event of Wechaty needs to take a <code>userSelf</code> instance, and it needs to be <code>ready-ed</code>.</li></ol><p>So there will be some delay before the Wechaty emit the <code>login</code> event after it received the <code>login</code> event from its puppet.</p><p>Please pay attention to this behavior and let me know if this issue was caused by it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="potential-solution"></a>Potential Solution<a class="hash-link" href="#potential-solution" title="Direct link to heading">#</a></h3><p>For a more robust Wechaty system, we can consider saving the <code>ready</code> event if the <code>login</code> event is not emitted in Wechaty.</p><p>And when we emit the <code>login</code> event in Wechaty, we can check if the puppet has already <code>ready-ed</code>, and if so, it can emit the <code>ready</code> event right after the <code>login</code> event.</p><p>See: <a href="https://github.com/wechaty/puppet-services/issues/31" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/puppet-services/issues/31</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="event-ready"></a>Event: <code>ready</code><a class="hash-link" href="#event-ready" title="Direct link to heading">#</a></h2><p>Need to fire <code>ready</code> event after the bot logined and all data has been synced.</p><blockquote><p>For example, after we re-installed the WeChat app on our phone, it has to load contacts/rooms from the server for a long time.</p></blockquote><p>See: <a href="https://github.com/wechaty/wechaty-puppet-service/issues/18" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-service/issues/18</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="npm-publication"></a>NPM Publication<a class="hash-link" href="#npm-publication" title="Direct link to heading">#</a></h2><ul class="contains-task-list"><li class="task-list-item"><input type="checkbox" disabled=""> <code>wechaty-puppet</code> must not a dependency. It should be put in devDependencies and peerDependencies</li><li class="task-list-item"><input type="checkbox" disabled=""> <code>wechaty</code> must not a dependency. It should be put in devDependencies and peerDependencies</li><li class="task-list-item"><input type="checkbox" disabled=""> must exist <code>examples/ding-dong-bot.ts</code> to implement the ding/dong logic, use puppet api only.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="event-heartbeat"></a>Event: <code>heartbeat</code><a class="hash-link" href="#event-heartbeat" title="Direct link to heading">#</a></h2><p>Puppet must emit heartbeats for provide a health check signal.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="the-heartbeat-design"></a>The <code>heartbeat</code> design<a class="hash-link" href="#the-heartbeat-design" title="Direct link to heading">#</a></h3><p>Here are the details:</p><ol><li>Wechaty Puppet is designed to emit at least one event in 60 seconds. If we do not have any events to emit, then we need to emit a <code>heartbeat</code> event so that it can prove itself is alive and healthy. See: <a href="https://github.com/wechaty/wechaty-puppet/blob/bab9e29c088c33fa8bc6e148d9bdadbd453fd138/src/puppet.ts#L253-L254" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/blob/bab9e29c088c33fa8bc6e148d9bdadbd453fd138/src/puppet.ts#L253-L254</a></li><li>It seems that the PadLocal does not have any <code>heartbeat</code> event to emit when there are no other events, so if your bot idle for more than 60 seconds, then the Wechaty Puppet system will think the puppet provider has dead, so it will call <code>reset</code> to try to recover the puppet.</li></ol><p>A leaking of <code>heartbeat</code> example logs:</p><div class="codeBlockContainer_1ukp"><div class="codeBlockContent_3Y8q sh"><div tabindex="0" class="prism-code language-sh codeBlock_2Xgr thin-scrollbar"><div class="codeBlockLines_3Zfi" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:00:13 INFO StarterBot Message#Text[🗣Contact&lt;OssChat&gt;@👥Room&lt;ChatOps - Heartbeat 💖&gt;] [太阳]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 WARN Puppet dogReset() reason: {&quot;data&quot;:&quot;onGrpcStreamEvent(EVENT_TYPE_MESSAGE)&quot;,&quot;timeout&quot;:60000}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB Puppet reset(onGrpcStreamEvent(EVENT_TYPE_MESSAGE))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB PuppetService stop()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB StateSwitch &lt;PuppetService&gt; off(pending) &lt;- (false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB PuppetService stopGrpcStream()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB PuppetService stopGrpcClient()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB Puppet selfId()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB StateSwitch &lt;PuppetService&gt; off(true) &lt;- (pending)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 INFO StarterBot Contact&lt;Mike (李卓桓)&gt; logout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB PuppetService start()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB StateSwitch &lt;PuppetService&gt; on(pending) &lt;- (false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB PuppetService startGrpcClient()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:13 VERB PuppetService discoverServiceIp(e49007b7-7523-4a80-bfdb-1be0de3844b9)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:14 VERB PuppetService startGrpcStream()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:14 VERB StateSwitch &lt;PuppetService&gt; on(true) &lt;- (pending)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:14 VERB PuppetService onGrpcStreamEvent({type:EVENT_TYPE_LOGIN(25), payload:&quot;{&quot;contactId&quot;:&quot;wxid_a8d806dzznm822&quot;}&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:14 INFO StarterBot Contact&lt;Mike (李卓桓)&gt; login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:15 VERB PuppetService onGrpcStreamEvent({type:EVENT_TYPE_READY(23), payload:&quot;{&quot;data&quot;:&quot;ready&quot;}&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:15 VERB StateSwitch &lt;WechatyReady&gt; on(true) &lt;- (true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:20 VERB PuppetService onGrpcStreamEvent({type:EVENT_TYPE_READY(23), payload:&quot;{&quot;data&quot;:&quot;ready&quot;}&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">02:01:20 VERB StateSwitch &lt;WechatyReady&gt; on(true) &lt;- (true)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1mju">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="heartbeat-example"></a><code>heartbeat</code> Example<a class="hash-link" href="#heartbeat-example" title="Direct link to heading">#</a></h3><p>Here&#x27;s an <a href="https://github.com/wechaty/wechaty-puppet-puppeteer/blob/07f6260b3784c65bcee24bd003aac5d2968a9efc/src/wechaty-bro.js#L103-L112" target="_blank" rel="noopener noreferrer">example</a> from our puppeteer puppet, which emits heartbeats in the browser, so if the browser dead, we will get to know because the heartbeat will be lost.</p><p>See: <a href="https://github.com/wechaty/puppet-services/issues/85#issuecomment-769967606" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/puppet-services/issues/85#issuecomment-769967606</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="wechaty-puppet-message-processing-flow"></a>Wechaty Puppet Message Processing Flow<a class="hash-link" href="#wechaty-puppet-message-processing-flow" title="Direct link to heading">#</a></h2><p>Yes, <code>video</code> messagge is not supported now, and pr is welcome. I believe this feature is simple for you. You can have a try so you can become a wechaty contributor 👍
Please refer to :</p><ul><li><a href="https://developers.weixin.qq.com/doc/offiaccount/Asset_Management/New_temporary_materials.html" target="_blank" rel="noopener noreferrer">message material in official-account</a></li><li><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/master/src/official-account/official-account.ts#L299" target="_blank" rel="noopener noreferrer">sendFile method</a></li><li><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/master/src/puppet-oa.ts#L495" target="_blank" rel="noopener noreferrer">messageSend method</a></li></ul><p>We now support very limit message types:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/webhook.ts#L241-L244" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/webhook.ts#L241-L244</a></p><p>In order to support receiving more message types, like audio, you need to look at:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/webhook.ts#L247-L252" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/webhook.ts#L247-L252</a></p><p>Congratulations! It seems that you can receive the right webhook payload from WeChat Official Server when you sent an audio message to your Official Account!</p><p>However, it seems that the <em>Wechaty Message Payload</em> has not been set correctly. In order to make it correct, you need to understand the message processing flow in Wechaty Puppet.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="wechaty-puppet-message-processing-flow-1"></a>Wechaty Puppet Message Processing Flow<a class="hash-link" href="#wechaty-puppet-message-processing-flow-1" title="Direct link to heading">#</a></h3><ol><li><p>The Webhook get called by the Tencent Server (what you have done already)</p></li><li><p>The message <strong>event</strong> will be propagated from the <code>Webhook</code> class to the <code>OfficialAccount</code> class:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/official-account.ts#L116-L119" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/official-account.ts#L116-L119</a></p></li><li><p>The message <strong>event</strong> will be propagated from the <code>OfficialAccount</code> class to the <code>PuppetOA</code> class:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L188-L189" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L188-L189</a></p></li><li><p>After message <strong>event</strong> be propagated from the PuppetOA to Wechaty, then the <a href="https://github.com/wechaty/wechaty-puppet/blob/763e94194fd1104007fccad4ba4994365890cde8/src/puppet.ts#L834" target="_blank" rel="noopener noreferrer">puppet.messagePayload()</a> will be called to get the <a href="https://github.com/wechaty/wechaty-puppet/blob/763e94194fd1104007fccad4ba4994365890cde8/src/schemas/message.ts#L103" target="_blank" rel="noopener noreferrer">Wechaty Message Payload</a>.  Here is the most important part: we need to construct a Wechaty Message Payload from the Raw Message Payload (source code at <a href="https://github.com/wechaty/wechaty-puppet/blob/763e94194fd1104007fccad4ba4994365890cde8/src/puppet.ts#L854-L855" target="_blank" rel="noopener noreferrer">here</a>):</p><div class="codeBlockContainer_1ukp"><div class="codeBlockContent_3Y8q ts"><div tabindex="0" class="prism-code language-ts codeBlock_2Xgr thin-scrollbar"><div class="codeBlockLines_3Zfi" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> rawPayload </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">messageRawPayload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">messageId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> payload    </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">messageRawPayloadParser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rawPayload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1mju">Copy</button></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="what-to-do-next"></a>What to Do Next<a class="hash-link" href="#what-to-do-next" title="Direct link to heading">#</a></h3><p>So it will be very clear that, what we need to do to support the new Message Type (audio in this case), is to implement the <code>messageRawPayload</code> methods, which you can find here:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L456-L478" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L456-L478</a></p><p>I hope the above explanation could help you to move forward, please feel free to let me know if you have more questions.</p><p>See: <a href="https://github.com/wechaty/wechaty-puppet-official-account/issues/19" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/issues/19</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="dingdong-protocol"></a><code>Ding</code>/<code>Dong</code> Protocol<a class="hash-link" href="#dingdong-protocol" title="Direct link to heading">#</a></h2><p>Puppet has a API named <code>ding(data: string): void</code>, and the Puppet must:</p><ol><li>emit a <code>dong</code> event when the <code>ding()</code> method has been called</li><li>the payload of the <code>dong</code> event might contains a <code>data</code> key with the value exactly match the <code>data</code> when calling the <code>ding()</code> method.</li></ol><p>This is for active(passive) health checking, and this is also a workaround for some edge case communication between the top puppet with the bottom puppet.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="learn-more"></a>Learn More<a class="hash-link" href="#learn-more" title="Direct link to heading">#</a></h2><ul><li>Puppet Related Links: <a href="https://github.com/wechaty/wechaty-puppet/wiki/Links" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/wiki/Links</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wechaty/wechaty.js.org/edit/master/docusaurus/docs/specs/puppet.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_1CBY" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-03-28T12:09:30.000Z" class="lastUpdatedDate_Xku4">3/28/2021</time> by <strong>Huan LI (李卓桓)</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/specs/plugin"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Wechaty Plugin</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/specs/service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Wechaty Puppet Service »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3J2a thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-wechaty-puppet" class="table-of-contents__link">What is Wechaty Puppet</a></li><li><a href="#show-me-the-code" class="table-of-contents__link">Show me the code</a><ul><li><a href="#important-puppets" class="table-of-contents__link">Important Puppets</a></li></ul></li><li><a href="#using-puppet-with-wechaty-examples" class="table-of-contents__link">Using Puppet with Wechaty Examples</a></li><li><a href="#basic-rules" class="table-of-contents__link">Basic Rules</a></li><li><a href="#memorycard" class="table-of-contents__link">MemoryCard</a><ul><li><a href="#wechaty-bot-login-with-memory-card-module" class="table-of-contents__link">Wechaty bot login with memory card module</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></li><li><a href="#event-order" class="table-of-contents__link">Event Order</a><ul><li><a href="#potential-solution" class="table-of-contents__link">Potential Solution</a></li></ul></li><li><a href="#event-ready" class="table-of-contents__link">Event: <code>ready</code></a></li><li><a href="#npm-publication" class="table-of-contents__link">NPM Publication</a></li><li><a href="#event-heartbeat" class="table-of-contents__link">Event: <code>heartbeat</code></a><ul><li><a href="#the-heartbeat-design" class="table-of-contents__link">The <code>heartbeat</code> design</a></li><li><a href="#heartbeat-example" class="table-of-contents__link"><code>heartbeat</code> Example</a></li></ul></li><li><a href="#wechaty-puppet-message-processing-flow" class="table-of-contents__link">Wechaty Puppet Message Processing Flow</a><ul><li><a href="#wechaty-puppet-message-processing-flow-1" class="table-of-contents__link">Wechaty Puppet Message Processing Flow</a></li><li><a href="#what-to-do-next" class="table-of-contents__link">What to Do Next</a></li></ul></li><li><a href="#dingdong-protocol" class="table-of-contents__link"><code>Ding</code>/<code>Dong</code> Protocol</a></li><li><a href="#learn-more" class="table-of-contents__link">Learn More</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/explainations/">Explainations</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/references/">References</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/howto/">Howto Guides</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://gitter.im/wechaty/wechaty" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://github.com/wechaty/wechaty/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussion</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/wechaty" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://t.me/wechaty" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://twitter.com/chatieio" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://bit.ly/3aoLE86" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a href="https://opencollective.com/wechaty" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Collective</a></li><li class="footer__item"><a href="https://bit.ly/33Dfkuf" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Drive</a></li><li class="footer__item"><a href="https://photos.app.goo.gl/LkmYMWypGoJdyvEJ6" target="_blank" rel="noopener noreferrer" class="footer__link-item">Photo Album</a></li><li class="footer__item"><a href="https://bit.ly/2zpi2XG" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meeting Notes</a></li><li class="footer__item"><a href="https://bit.ly/2J6ziXa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hall of Fame</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://wechaty.js.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="http://www.bot5.club/blogs/chatbot-0-1/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Book</a></li><li class="footer__item"><a class="footer__link-item" href="/branding">Branding</a></li><li class="footer__item"><a class="footer__link-item" href="/press">Press</a></li><li class="footer__item"><a href="https://github.com/wechaty/wechaty#readme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://chatie.statuspage.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://wechaty.js.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1gX9"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--light_2_E0 footer__logo"><img src="/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_Ir0T themedImage--dark_2JiM footer__logo"></a></div><div class="footer__copyright">Copyright © 2016-2021 Wechaty Contributors</div></div></div></footer></div>
<script src="/assets/js/styles.c2065dab.js"></script>
<script src="/assets/js/runtime~main.fe416c82.js"></script>
<script src="/assets/js/main.ed8f1f7a.js"></script>
<script src="/assets/js/1.b730686f.js"></script>
<script src="/assets/js/2.474dd42e.js"></script>
<script src="/assets/js/3.0266c80a.js"></script>
<script src="/assets/js/1be78505.200364f1.js"></script>
<script src="/assets/js/167.6b2947d8.js"></script>
<script src="/assets/js/935f2afb.df2000e1.js"></script>
<script src="/assets/js/17896441.44b72e1f.js"></script>
<script src="/assets/js/8153f4e2.2716646b.js"></script>
</body>
</html>